var jsonString = "{\n    \"game_duration\": 300,\n    \"initial_credits\": 1984,\n    \"items\": [\n        \"Dwimeryt\",\n        \"Cynamon\",\n        \"Nuka-Cola\",\n        \"Z\u0142oto\",\n        \"Unobtainium\",\n        \"Protea\u0144skie dyski\",\n        \"Ziemniaki\",\n        \"Lyrium\",\n        \"Murkwie\",\n        \"Woda\"\n    ],\n    \"planets\": {\n        \"Alderaan\": {\n            \"available_items\": {\n                \"Cynamon\": {\n                    \"available\": 74,\n                    \"buy_price\": 6,\n                    \"sell_price\": 6\n                },\n                \"Dwimeryt\": {\n                    \"available\": 42,\n                    \"buy_price\": 12,\n                    \"sell_price\": 11\n                },\n                \"Nuka-Cola\": {\n                    \"available\": 34,\n                    \"buy_price\": 13,\n                    \"sell_price\": 12\n                },\n                \"Protea\u0144skie dyski\": {\n                    \"available\": 5,\n                    \"buy_price\": 76,\n                    \"sell_price\": 69\n                },\n                \"Unobtainium\": {\n                    \"available\": 23,\n                    \"buy_price\": 33,\n                    \"sell_price\": 31\n                },\n                \"Woda\": {\n                    \"available\": 22,\n                    \"buy_price\": 19,\n                    \"sell_price\": 18\n                },\n                \"Ziemniaki\": {\n                    \"available\": 10,\n                    \"buy_price\": 92,\n                    \"sell_price\": 86\n                },\n                \"Z\u0142oto\": {\n                    \"available\": 12,\n                    \"buy_price\": 19,\n                    \"sell_price\": 17\n                }\n            },\n            \"x\": 15,\n            \"y\": 32\n        },\n        \"Argoland\": {\n            \"available_items\": {\n                \"Dwimeryt\": {\n                    \"available\": 23,\n                    \"buy_price\": 10,\n                    \"sell_price\": 10\n                },\n                \"Lyrium\": {\n                    \"available\": 39,\n                    \"buy_price\": 9,\n                    \"sell_price\": 8\n                },\n                \"Murkwie\": {\n                    \"available\": 5,\n                    \"buy_price\": 73,\n                    \"sell_price\": 64\n                },\n                \"Nuka-Cola\": {\n                    \"available\": 25,\n                    \"buy_price\": 22,\n                    \"sell_price\": 19\n                },\n                \"Protea\u0144skie dyski\": {\n                    \"available\": 10,\n                    \"buy_price\": 75,\n                    \"sell_price\": 65\n                },\n                \"Ziemniaki\": {\n                    \"available\": 6,\n                    \"buy_price\": 69,\n                    \"sell_price\": 61\n                },\n                \"Z\u0142oto\": {\n                    \"available\": 12,\n                    \"buy_price\": 34,\n                    \"sell_price\": 30\n                }\n            },\n            \"x\": 59,\n            \"y\": 44\n        },\n        \"Arrakis\": {\n            \"available_items\": {\n                \"Cynamon\": {\n                    \"available\": 59,\n                    \"buy_price\": 8,\n                    \"sell_price\": 7\n                },\n                \"Lyrium\": {\n                    \"available\": 53,\n                    \"buy_price\": 10,\n                    \"sell_price\": 8\n                },\n                \"Murkwie\": {\n                    \"available\": 6,\n                    \"buy_price\": 89,\n                    \"sell_price\": 76\n                },\n                \"Nuka-Cola\": {\n                    \"available\": 25,\n                    \"buy_price\": 16,\n                    \"sell_price\": 15\n                },\n                \"Protea\u0144skie dyski\": {\n                    \"available\": 7,\n                    \"buy_price\": 64,\n                    \"sell_price\": 57\n                },\n                \"Unobtainium\": {\n                    \"available\": 12,\n                    \"buy_price\": 36,\n                    \"sell_price\": 33\n                },\n                \"Woda\": {\n                    \"available\": 12,\n                    \"buy_price\": 25,\n                    \"sell_price\": 21\n                },\n                \"Ziemniaki\": {\n                    \"available\": 9,\n                    \"buy_price\": 120,\n                    \"sell_price\": 107\n                },\n                \"Z\u0142oto\": {\n                    \"available\": 16,\n                    \"buy_price\": 23,\n                    \"sell_price\": 21\n                }\n            },\n            \"x\": 81,\n            \"y\": 34\n        },\n        \"Corellia\": {\n            \"available_items\": {\n                \"Dwimeryt\": {\n                    \"available\": 38,\n                    \"buy_price\": 8,\n                    \"sell_price\": 8\n                },\n                \"Lyrium\": {\n                    \"available\": 63,\n                    \"buy_price\": 8,\n                    \"sell_price\": 7\n                },\n                \"Murkwie\": {\n                    \"available\": 6,\n                    \"buy_price\": 91,\n                    \"sell_price\": 84\n                },\n                \"Protea\u0144skie dyski\": {\n                    \"available\": 10,\n                    \"buy_price\": 74,\n                    \"sell_price\": 66\n                },\n                \"Unobtainium\": {\n                    \"available\": 11,\n                    \"buy_price\": 30,\n                    \"sell_price\": 26\n                },\n                \"Ziemniaki\": {\n                    \"available\": 12,\n                    \"buy_price\": 71,\n                    \"sell_price\": 66\n                },\n                \"Z\u0142oto\": {\n                    \"available\": 19,\n                    \"buy_price\": 37,\n                    \"sell_price\": 33\n                }\n            },\n            \"x\": 43,\n            \"y\": 69\n        },\n        \"Encja\": {\n            \"available_items\": {\n                \"Cynamon\": {\n                    \"available\": 59,\n                    \"buy_price\": 6,\n                    \"sell_price\": 5\n                },\n                \"Dwimeryt\": {\n                    \"available\": 56,\n                    \"buy_price\": 10,\n                    \"sell_price\": 10\n                },\n                \"Lyrium\": {\n                    \"available\": 51,\n                    \"buy_price\": 9,\n                    \"sell_price\": 8\n                },\n                \"Murkwie\": {\n                    \"available\": 6,\n                    \"buy_price\": 88,\n                    \"sell_price\": 76\n                },\n                \"Nuka-Cola\": {\n                    \"available\": 35,\n                    \"buy_price\": 17,\n                    \"sell_price\": 16\n                },\n                \"Protea\u0144skie dyski\": {\n                    \"available\": 9,\n                    \"buy_price\": 103,\n                    \"sell_price\": 90\n                },\n                \"Unobtainium\": {\n                    \"available\": 13,\n                    \"buy_price\": 39,\n                    \"sell_price\": 37\n                },\n                \"Woda\": {\n                    \"available\": 12,\n                    \"buy_price\": 32,\n                    \"sell_price\": 32\n                },\n                \"Ziemniaki\": {\n                    \"available\": 6,\n                    \"buy_price\": 60,\n                    \"sell_price\": 57\n                },\n                \"Z\u0142oto\": {\n                    \"available\": 26,\n                    \"buy_price\": 40,\n                    \"sell_price\": 35\n                }\n            },\n            \"x\": 91,\n            \"y\": 32\n        },\n        \"Gaia\": {\n            \"available_items\": {\n                \"Cynamon\": {\n                    \"available\": 80,\n                    \"buy_price\": 6,\n                    \"sell_price\": 6\n                },\n                \"Dwimeryt\": {\n                    \"available\": 85,\n                    \"buy_price\": 8,\n                    \"sell_price\": 7\n                },\n                \"Lyrium\": {\n                    \"available\": 41,\n                    \"buy_price\": 10,\n                    \"sell_price\": 9\n                },\n                \"Protea\u0144skie dyski\": {\n                    \"available\": 9,\n                    \"buy_price\": 102,\n                    \"sell_price\": 94\n                },\n                \"Woda\": {\n                    \"available\": 25,\n                    \"buy_price\": 43,\n                    \"sell_price\": 39\n                },\n                \"Ziemniaki\": {\n                    \"available\": 8,\n                    \"buy_price\": 92,\n                    \"sell_price\": 82\n                },\n                \"Z\u0142oto\": {\n                    \"available\": 16,\n                    \"buy_price\": 35,\n                    \"sell_price\": 31\n                }\n            },\n            \"x\": 75,\n            \"y\": 76\n        },\n        \"Ksi\": {\n            \"available_items\": {\n                \"Cynamon\": {\n                    \"available\": 33,\n                    \"buy_price\": 11,\n                    \"sell_price\": 10\n                },\n                \"Dwimeryt\": {\n                    \"available\": 80,\n                    \"buy_price\": 6,\n                    \"sell_price\": 6\n                },\n                \"Lyrium\": {\n                    \"available\": 64,\n                    \"buy_price\": 8,\n                    \"sell_price\": 7\n                },\n                \"Murkwie\": {\n                    \"available\": 4,\n                    \"buy_price\": 73,\n                    \"sell_price\": 67\n                },\n                \"Nuka-Cola\": {\n                    \"available\": 30,\n                    \"buy_price\": 17,\n                    \"sell_price\": 14\n                },\n                \"Protea\u0144skie dyski\": {\n                    \"available\": 8,\n                    \"buy_price\": 39,\n                    \"sell_price\": 37\n                },\n                \"Unobtainium\": {\n                    \"available\": 12,\n                    \"buy_price\": 41,\n                    \"sell_price\": 39\n                },\n                \"Woda\": {\n                    \"available\": 15,\n                    \"buy_price\": 30,\n                    \"sell_price\": 28\n                },\n                \"Ziemniaki\": {\n                    \"available\": 6,\n                    \"buy_price\": 74,\n                    \"sell_price\": 64\n                },\n                \"Z\u0142oto\": {\n                    \"available\": 16,\n                    \"buy_price\": 20,\n                    \"sell_price\": 18\n                }\n            },\n            \"x\": 91,\n            \"y\": 71\n        },\n        \"Leonida\": {\n            \"available_items\": {\n                \"Cynamon\": {\n                    \"available\": 36,\n                    \"buy_price\": 12,\n                    \"sell_price\": 11\n                },\n                \"Dwimeryt\": {\n                    \"available\": 50,\n                    \"buy_price\": 8,\n                    \"sell_price\": 7\n                },\n                \"Lyrium\": {\n                    \"available\": 60,\n                    \"buy_price\": 9,\n                    \"sell_price\": 9\n                },\n                \"Murkwie\": {\n                    \"available\": 6,\n                    \"buy_price\": 89,\n                    \"sell_price\": 85\n                },\n                \"Nuka-Cola\": {\n                    \"available\": 39,\n                    \"buy_price\": 18,\n                    \"sell_price\": 16\n                },\n                \"Protea\u0144skie dyski\": {\n                    \"available\": 7,\n                    \"buy_price\": 65,\n                    \"sell_price\": 57\n                },\n                \"Unobtainium\": {\n                    \"available\": 9,\n                    \"buy_price\": 38,\n                    \"sell_price\": 33\n                },\n                \"Ziemniaki\": {\n                    \"available\": 5,\n                    \"buy_price\": 121,\n                    \"sell_price\": 112\n                },\n                \"Z\u0142oto\": {\n                    \"available\": 11,\n                    \"buy_price\": 45,\n                    \"sell_price\": 41\n                }\n            },\n            \"x\": 32,\n            \"y\": 5\n        },\n        \"NowWhat\": {\n            \"available_items\": {\n                \"Cynamon\": {\n                    \"available\": 62,\n                    \"buy_price\": 8,\n                    \"sell_price\": 7\n                },\n                \"Dwimeryt\": {\n                    \"available\": 22,\n                    \"buy_price\": 9,\n                    \"sell_price\": 9\n                },\n                \"Murkwie\": {\n                    \"available\": 9,\n                    \"buy_price\": 67,\n                    \"sell_price\": 66\n                },\n                \"Nuka-Cola\": {\n                    \"available\": 27,\n                    \"buy_price\": 18,\n                    \"sell_price\": 16\n                },\n                \"Protea\u0144skie dyski\": {\n                    \"available\": 9,\n                    \"buy_price\": 82,\n                    \"sell_price\": 71\n                },\n                \"Ziemniaki\": {\n                    \"available\": 4,\n                    \"buy_price\": 74,\n                    \"sell_price\": 63\n                },\n                \"Z\u0142oto\": {\n                    \"available\": 17,\n                    \"buy_price\": 28,\n                    \"sell_price\": 24\n                }\n            },\n            \"x\": 35,\n            \"y\": 41\n        },\n        \"Sur'Kesh\": {\n            \"available_items\": {\n                \"Cynamon\": {\n                    \"available\": 55,\n                    \"buy_price\": 9,\n                    \"sell_price\": 8\n                },\n                \"Lyrium\": {\n                    \"available\": 34,\n                    \"buy_price\": 9,\n                    \"sell_price\": 8\n                },\n                \"Murkwie\": {\n                    \"available\": 10,\n                    \"buy_price\": 73,\n                    \"sell_price\": 66\n                },\n                \"Nuka-Cola\": {\n                    \"available\": 30,\n                    \"buy_price\": 19,\n                    \"sell_price\": 17\n                },\n                \"Protea\u0144skie dyski\": {\n                    \"available\": 5,\n                    \"buy_price\": 85,\n                    \"sell_price\": 79\n                },\n                \"Unobtainium\": {\n                    \"available\": 19,\n                    \"buy_price\": 34,\n                    \"sell_price\": 31\n                },\n                \"Woda\": {\n                    \"available\": 21,\n                    \"buy_price\": 23,\n                    \"sell_price\": 20\n                },\n                \"Ziemniaki\": {\n                    \"available\": 8,\n                    \"buy_price\": 99,\n                    \"sell_price\": 95\n                }\n            },\n            \"x\": 39,\n            \"y\": 31\n        },\n        \"Tairia\": {\n            \"available_items\": {\n                \"Cynamon\": {\n                    \"available\": 70,\n                    \"buy_price\": 10,\n                    \"sell_price\": 10\n                },\n                \"Lyrium\": {\n                    \"available\": 43,\n                    \"buy_price\": 6,\n                    \"sell_price\": 5\n                },\n                \"Murkwie\": {\n                    \"available\": 8,\n                    \"buy_price\": 97,\n                    \"sell_price\": 84\n                },\n                \"Nuka-Cola\": {\n                    \"available\": 32,\n                    \"buy_price\": 20,\n                    \"sell_price\": 19\n                },\n                \"Unobtainium\": {\n                    \"available\": 19,\n                    \"buy_price\": 44,\n                    \"sell_price\": 41\n                },\n                \"Woda\": {\n                    \"available\": 12,\n                    \"buy_price\": 29,\n                    \"sell_price\": 25\n                },\n                \"Ziemniaki\": {\n                    \"available\": 6,\n                    \"buy_price\": 123,\n                    \"sell_price\": 103\n                },\n                \"Z\u0142oto\": {\n                    \"available\": 14,\n                    \"buy_price\": 37,\n                    \"sell_price\": 34\n                }\n            },\n            \"x\": 36,\n            \"y\": 84\n        },\n        \"Tatooine\": {\n            \"available_items\": {\n                \"Cynamon\": {\n                    \"available\": 60,\n                    \"buy_price\": 11,\n                    \"sell_price\": 10\n                },\n                \"Dwimeryt\": {\n                    \"available\": 64,\n                    \"buy_price\": 10,\n                    \"sell_price\": 9\n                },\n                \"Lyrium\": {\n                    \"available\": 45,\n                    \"buy_price\": 8,\n                    \"sell_price\": 7\n                },\n                \"Murkwie\": {\n                    \"available\": 6,\n                    \"buy_price\": 81,\n                    \"sell_price\": 71\n                },\n                \"Nuka-Cola\": {\n                    \"available\": 39,\n                    \"buy_price\": 15,\n                    \"sell_price\": 13\n                },\n                \"Protea\u0144skie dyski\": {\n                    \"available\": 7,\n                    \"buy_price\": 89,\n                    \"sell_price\": 84\n                },\n                \"Unobtainium\": {\n                    \"available\": 13,\n                    \"buy_price\": 37,\n                    \"sell_price\": 32\n                },\n                \"Woda\": {\n                    \"available\": 10,\n                    \"buy_price\": 23,\n                    \"sell_price\": 21\n                },\n                \"Ziemniaki\": {\n                    \"available\": 7,\n                    \"buy_price\": 95,\n                    \"sell_price\": 87\n                },\n                \"Z\u0142oto\": {\n                    \"available\": 19,\n                    \"buy_price\": 35,\n                    \"sell_price\": 32\n                }\n            },\n            \"x\": 47,\n            \"y\": 68\n        },\n        \"Tuchanka\": {\n            \"available_items\": {\n                \"Cynamon\": {\n                    \"available\": 59,\n                    \"buy_price\": 10,\n                    \"sell_price\": 9\n                },\n                \"Dwimeryt\": {\n                    \"available\": 51,\n                    \"buy_price\": 7,\n                    \"sell_price\": 6\n                },\n                \"Lyrium\": {\n                    \"available\": 65,\n                    \"buy_price\": 11,\n                    \"sell_price\": 10\n                },\n                \"Murkwie\": {\n                    \"available\": 9,\n                    \"buy_price\": 90,\n                    \"sell_price\": 82\n                },\n                \"Nuka-Cola\": {\n                    \"available\": 46,\n                    \"buy_price\": 18,\n                    \"sell_price\": 16\n                },\n                \"Protea\u0144skie dyski\": {\n                    \"available\": 10,\n                    \"buy_price\": 71,\n                    \"sell_price\": 65\n                },\n                \"Unobtainium\": {\n                    \"available\": 8,\n                    \"buy_price\": 39,\n                    \"sell_price\": 37\n                },\n                \"Woda\": {\n                    \"available\": 15,\n                    \"buy_price\": 28,\n                    \"sell_price\": 24\n                },\n                \"Ziemniaki\": {\n                    \"available\": 10,\n                    \"buy_price\": 61,\n                    \"sell_price\": 57\n                },\n                \"Z\u0142oto\": {\n                    \"available\": 12,\n                    \"buy_price\": 46,\n                    \"sell_price\": 40\n                }\n            },\n            \"x\": 27,\n            \"y\": 76\n        },\n        \"Ziemia\": {\n            \"available_items\": {\n                \"Cynamon\": {\n                    \"available\": 58,\n                    \"buy_price\": 8,\n                    \"sell_price\": 7\n                },\n                \"Dwimeryt\": {\n                    \"available\": 106,\n                    \"buy_price\": 8,\n                    \"sell_price\": 7\n                },\n                \"Lyrium\": {\n                    \"available\": 31,\n                    \"buy_price\": 9,\n                    \"sell_price\": 8\n                },\n                \"Murkwie\": {\n                    \"available\": 7,\n                    \"buy_price\": 82,\n                    \"sell_price\": 75\n                },\n                \"Nuka-Cola\": {\n                    \"available\": 30,\n                    \"buy_price\": 18,\n                    \"sell_price\": 17\n                },\n                \"Unobtainium\": {\n                    \"available\": 21,\n                    \"buy_price\": 37,\n                    \"sell_price\": 36\n                },\n                \"Ziemniaki\": {\n                    \"available\": 6,\n                    \"buy_price\": 77,\n                    \"sell_price\": 69\n                },\n                \"Z\u0142oto\": {\n                    \"available\": 13,\n                    \"buy_price\": 38,\n                    \"sell_price\": 32\n                }\n            },\n            \"x\": 94,\n            \"y\": 24\n        }\n    },\n    \"starships\": {\n        \"Axiom\": {\n            \"cargo_hold_size\": 27,\n            \"position\": \"Tatooine\"\n        },\n        \"Enterprise\": {\n            \"cargo_hold_size\": 46,\n            \"position\": \"Corellia\"\n        },\n        \"Goliath\": {\n            \"cargo_hold_size\": 33,\n            \"position\": \"Sur'Kesh\"\n        },\n        \"Hermes\": {\n            \"cargo_hold_size\": 26,\n            \"position\": \"NowWhat\"\n        },\n        \"Millenium Falcon\": {\n            \"cargo_hold_size\": 35,\n            \"position\": \"Tatooine\"\n        },\n        \"Niezwyci\u0119\u017Cony\": {\n            \"cargo_hold_size\": 60,\n            \"position\": \"Argoland\"\n        },\n        \"Normandy SR-2\": {\n            \"cargo_hold_size\": 40,\n            \"position\": \"Gaia\"\n        },\n        \"Nostromo\": {\n            \"cargo_hold_size\": 25,\n            \"position\": \"Arrakis\"\n        },\n        \"Rocinante\": {\n            \"cargo_hold_size\": 30,\n            \"position\": \"Alderaan\"\n        },\n        \"\u041A\u043E\u0441\u043C\u043E\u043D\u0430\u0432\u0442 \u0410\u043B\u0435\u043A\u0441\u0435\u0301\u0439 \u041B\u0435\u043E\u0301\u043D\u043E\u0432\": {\n            \"cargo_hold_size\": 35,\n            \"position\": \"Arrakis\"\n        }\n    }\n}\n";
var timeMultiplier = 1000;
var scoreboardLimit = 10;
var boxPlayerName = "player-name";
var displayBlock = "block";
var displayNone = "none";
var displayFlex = "flex";
var listOfPrices = "market";
var listOfOffers = "offers";
var playerNameDefault = "a mysterious stranger";
var positionEnRoute = "hyperspace";
var screenBuy = "buy";
var screenGame = "game-main";
var screenGameOver = "game-over";
var screenLogin = "login";
var screenPlanet = "planet-pop-up";
var screenSell = "sell";
var screenStarshipAtPlanet = "ship-at-planet";
var screenStarshipEnRoute = "starship-en-route";
var tableStarships = "starships";
var GameState = /** @class */ (function () {
    function GameState() {
        this.credits = parsed.initial_credits;
        this.remainingTime = parsed.game_duration;
        this.planets = {};
        this.starships = {};
        this.addPlanets();
        this.addStarships();
    }
    GameState.prototype.addPlanets = function () {
        for (var i in parsed.planets) {
            this.planets[i] = new Position(i);
            var items = parsed.planets[i].available_items;
            for (var j in items) {
                this.planets[i].available_items[j] = new Good(j, i);
            }
        }
    };
    GameState.prototype.addStarships = function () {
        for (var i in parsed.starships) {
            this.starships[i] = new Starship(i);
        }
    };
    return GameState;
}());
var Good = /** @class */ (function () {
    function Good(name, planet) {
        var items = parsed.planets[planet].available_items;
        this.name = name;
        this.available = parseInt(items[name].available);
        this.buy_price = parseInt(items[name].buy_price);
        this.sell_price = parseInt(items[name].sell_price);
    }
    return Good;
}());
var Position = /** @class */ (function () {
    function Position(name) {
        this.name = name;
        this.available_items = {};
        this.x = parsed.planets[name].x;
        this.y = parsed.planets[name].y;
    }
    return Position;
}());
var Starship = /** @class */ (function () {
    function Starship(name) {
        var size;
        this.enRoute = false;
        this.name = name;
        this.cargo = {};
        size = parsed.starships[name].cargo_hold_size;
        this.cargoSpace = size;
        this.position = parsed.starships[name].position;
    }
    return Starship;
}());
var parsed = JSON.parse(jsonString);
var game;
function addScore(score, name) {
    for (var i = scoreboardLimit; i > 0; --i) {
        var scoreCode = scoreboardLimit * score + i - 1;
        if (localStorage.getItem(scoreCode.toString())) {
            continue;
        }
        localStorage.setItem(scoreCode.toString(), name);
        break;
    }
    return;
}
function arrive(starship) {
    if (starship === game.currentStarship) {
        if (whichScreen() === screenStarshipEnRoute) {
            showStarshipAtPlanet(starship);
        }
    }
    game.starships[starship].enRoute = false;
    var elements = document.getElementsByClassName(tableStarships);
    var position = game.starships[starship].position;
    for (var i = 0; i < elements.length; ++i) {
        var el = elements[i];
        for (var j = 0; j < el.rows.length; ++j) {
            var children = el.rows[j].cells[0].children;
            if (children[0].textContent === starship) {
                children[1].textContent = position;
            }
        }
    }
}
function buyGoods(good, amount) {
    var items = game.planets[game.currentPlanet].available_items;
    var price = items[good].buy_price;
    var starship = game.starships[game.currentStarship];
    if (greater(price * amount, game.credits)) {
        return;
    }
    if (greater(amount, starship.cargoSpace)) {
        return;
    }
    creditsUpdate(-price * amount);
    starship.cargoSpace -= amount;
    if (typeof starship.cargo[good] === "undefined") {
        starship.cargo[good] = 0;
    }
    starship.cargo[good] += amount;
    trimOffersBuy(good);
}
function calculateDistance(diffX, diffY) {
    var squareX = Math.pow(diffX, 2);
    var squareY = Math.pow(diffY, 2);
    var preciseResult = Math.sqrt(squareX + squareY);
    return Math.round(preciseResult);
}
function clear(x) {
    while (x.rows.length > 1) {
        x.deleteRow(1);
    }
}
function clickPlanet(planet) {
    showPlanet(planet);
}
function clickPlay() {
    showNameChoice();
}
function clickStarship(starship) {
    setStarship(starship);
    if (game.starships[starship].enRoute) {
        showStarshipEnRoute(starship);
        return;
    }
    showStarshipAtPlanet(starship);
}
function clickStart() {
    prepareGame();
}
function clickTradeBackdrop() {
    showStarshipAtPlanet(game.currentStarship);
}
function closePopups() {
    var elements = document.getElementsByClassName("pop-up");
    for (var i = 0; i < elements.length; ++i) {
        var el = elements[i];
        el.style.display = displayNone;
    }
    listPlanets();
    listStarships();
}
function creditsUpdate(x) {
    game.credits += x;
    var elements = document.getElementsByClassName("credits");
    for (var i = 0; i < elements.length; ++i) {
        var el = elements[i];
        el.textContent = game.credits.toString();
    }
}
function depart(destination) {
    var starship = game.starships[game.currentStarship];
    starship.enRoute = true;
    starship.position = destination;
    showStarshipEnRoute(game.currentStarship);
    setTimeout(function () {
        arrive(starship.name);
    }, timeMultiplier * getDistance(destination));
}
function gameOver() {
    addScore(game.credits, game.playerName);
    while (localStorage.length > 10) {
        trimScores();
    }
    showGameOver();
}
function getAmount(j) {
    if (j % 3 === 0) {
        return Math.pow(10, Math.floor(j / 3));
    }
    if (j % 3 === 1) {
        return 2 * Math.pow(10, Math.floor(j / 3));
    }
    if (j % 3 === 2) {
        return 5 * Math.pow(10, Math.floor(j / 3));
    }
}
function getDistance(destination) {
    var x = game.planets[destination].x;
    var y = game.planets[destination].y;
    var diffX = game.planets[game.currentPlanet].x - x;
    var diffY = game.planets[game.currentPlanet].y - y;
    return calculateDistance(diffX, diffY);
}
function greater(lhs, rhs) {
    return lhs > rhs;
}
function listCargo(starship) {
    var elements = document.getElementsByClassName("cargo");
    for (var i = 0; i < elements.length; ++i) {
        var el = elements[i];
        clear(el);
        var _loop_1 = function (j) {
            var cell = el.insertRow().insertCell();
            var left = makeA();
            cell.appendChild(left);
            left.textContent = j;
            left.onclick = function () { return showSell(j); };
            var right = makeA();
            cell.appendChild(right);
            right.textContent = game.starships[starship].cargo[j].toString();
        };
        for (var j in game.starships[starship].cargo) {
            _loop_1(j);
        }
    }
}
function listGoods(planet) {
    var elements = document.getElementsByClassName("stockpile");
    for (var i = 0; i < elements.length; ++i) {
        var el = elements[i];
        var items = game.planets[planet].available_items;
        clear(el);
        var _loop_2 = function (j) {
            var cell = el.insertRow().insertCell();
            var left = makeA();
            cell.appendChild(left);
            left.textContent = j;
            left.onclick = function () { return showBuy(j); };
            var right = makeA();
            cell.appendChild(right);
            right.textContent = game.planets[planet].available_items[j].available.toString();
        };
        for (var j in items) {
            _loop_2(j);
        }
    }
}
function listMarket(planet) {
    var elements = document.getElementsByClassName(listOfPrices);
    var items = game.planets[planet].available_items;
    for (var i = 0; i < elements.length; ++i) {
        var el = elements[i];
        clear(el);
        for (var j in items) {
            var cell = el.insertRow().insertCell();
            var left = makeA();
            cell.appendChild(left);
            left.textContent = j;
            var right = makeA();
            cell.appendChild(right);
            right.textContent = items[j].buy_price.toString();
            right.textContent += "/";
            right.textContent += items[j].sell_price.toString();
        }
    }
}
function listOffersBuy(good, price, amountLimit) {
    var elements = document.getElementsByClassName(listOfOffers);
    for (var i = 0; i < elements.length; ++i) {
        var el = elements[i];
        clear(el);
        var _loop_3 = function (j) {
            var amount = getAmount(j);
            var cell = el.insertRow().insertCell();
            var left = makeA();
            cell.appendChild(left);
            left.textContent = amount.toString();
            var right = makeA();
            cell.appendChild(right);
            var totalPrice = amount * price;
            right.textContent = totalPrice.toString();
            left.onclick = function () { return buyGoods(good, amount); };
        };
        for (var j = 0; getAmount(j) < amountLimit; ++j) {
            _loop_3(j);
        }
    }
}
function listOffersSell(good, price, amountLimit) {
    var elements = document.getElementsByClassName(listOfOffers);
    for (var i = 0; i < elements.length; ++i) {
        var el = elements[i];
        clear(el);
        var _loop_4 = function (j) {
            var amount = getAmount(j);
            var cell = el.insertRow().insertCell();
            var left = makeA();
            cell.appendChild(left);
            left.textContent = amount.toString();
            var right = makeA();
            cell.appendChild(right);
            var totalPrice = amount * price;
            right.textContent = totalPrice.toString();
            left.onclick = function () { return sellGoods(good, amount); };
        };
        for (var j = 0; getAmount(j) < amountLimit; ++j) {
            _loop_4(j);
        }
    }
}
function listPlanets() {
    var elements = document.getElementsByClassName("planets");
    for (var i = 0; i < elements.length; ++i) {
        var el = elements[i];
        clear(el);
        var _loop_5 = function (j) {
            var cell = el.insertRow().insertCell();
            var left = makeA();
            cell.appendChild(left);
            left.textContent = j;
            left.onclick = function () { return clickPlanet(j); };
            var right = makeA();
            cell.appendChild(right);
            right.textContent = planetGetXY(game.planets[j]);
        };
        for (var j in game.planets) {
            _loop_5(j);
        }
    }
}
function listScores() {
    var keys = [];
    for (var i = 0; i < localStorage.length; ++i) {
        var key = localStorage.key(i);
        keys.push(parseInt(key));
    }
    keys.sort(function (a, b) { return a - b; });
    var elements = document.getElementsByClassName("scoreboard");
    for (var i = 0; i < elements.length; ++i) {
        var el = elements[i];
        clear(el);
        for (var j = keys.length; j > 0; --j) {
            var cell = el.insertRow().insertCell();
            var left = makeA();
            cell.appendChild(left);
            left.textContent = localStorage.getItem(keys[j - 1].toString());
            var right = makeA();
            cell.appendChild(right);
            right.textContent = (Math.floor(keys[j - 1] / 10)).toString();
        }
    }
}
function listStarships() {
    var elements = document.getElementsByClassName(tableStarships);
    for (var i = 0; i < elements.length; ++i) {
        var el = elements[i];
        clear(el);
        var _loop_6 = function (j) {
            var starship = game.starships[j];
            var cell = el.insertRow().insertCell();
            var planet = game.starships[j].position;
            var left = makeA();
            cell.appendChild(left);
            left.textContent = j;
            left.onclick = function () { return clickStarship(j); };
            var right = makeA();
            cell.appendChild(right);
            right.textContent = planet;
            if (starship.enRoute) {
                right.textContent = positionEnRoute;
            }
            right.onclick = function () { return clickPlanet(planet); };
        };
        for (var j in game.starships) {
            _loop_6(j);
        }
    }
}
function listStarshipsAt(planet) {
    var elements = document.getElementsByClassName("orbit");
    for (var i = 0; i < elements.length; ++i) {
        var el = elements[i];
        clear(el);
        var _loop_7 = function (j) {
            var planet1 = game.starships[j].position.toString();
            if (planet1 === planet) {
                var cell = el.insertRow().insertCell();
                var left = makeA();
                cell.appendChild(left);
                left.textContent = j;
                left.onclick = function () { return clickStarship(j); };
                var right = makeA();
                cell.appendChild(right);
                right.textContent = planet;
            }
        };
        for (var j in game.starships) {
            _loop_7(j);
        }
    }
}
function makeA() {
    return document.createElement("a");
}
function planetGetXY(planet) {
    return "".concat(planet.x.toString())
        .concat(", ")
        .concat(planet.y.toString());
}
function prepareGame() {
    game = new GameState;
    document.getElementById("welcome").style.display = displayNone;
    setPlayerName();
    document.getElementById(screenGame).style.display = displayBlock;
    var elements = document.getElementsByClassName("info-box");
    for (var i = 0; i < elements.length; ++i) {
        var el = elements[i];
        el.style.display = displayBlock;
    }
    closePopups();
    listPlanets();
    listStarships();
    startGame();
    creditsUpdate(0);
}
function refresh() {
    window.location.reload();
}
function sellGoods(good, amount) {
    var items = game.planets[game.currentPlanet].available_items;
    var price = items[good].sell_price;
    var starship = game.starships[game.currentStarship];
    if (greater(amount, starship.cargo[good])) {
        return;
    }
    creditsUpdate(price * amount);
    starship.cargoSpace += amount;
    starship.cargo[good] -= amount;
    trimOffersSell(good);
}
function setDefaultScores() {
    addScore(271828, "Leo E.");
    addScore(1984, "W. Smith");
    addScore(2001, "Q. Brick");
    addScore(1979, "S. Weaver");
    addScore(1865, "JGV");
}
function setPlanet(x) {
    game.currentPlanet = x;
    var elements = document.getElementsByClassName("planet-name");
    for (var i = 0; i < elements.length; ++i) {
        var el = elements[i];
        el.textContent = x;
    }
}
function setPlayerName() {
    var nameBox = document.getElementById("player-name-input");
    game.playerName = nameBox.value;
    if (game.playerName === "") {
        game.playerName = playerNameDefault;
    }
    var elements = document.getElementsByClassName(boxPlayerName);
    for (var i = 0; i < elements.length; ++i) {
        var el = elements[i];
        el.textContent = game.playerName;
    }
}
function setStarship(x) {
    game.currentStarship = x;
    var elements = document.getElementsByClassName("starship-name");
    for (var i = 0; i < elements.length; ++i) {
        var el = elements[i];
        el.textContent = x;
    }
}
function showAbout() {
    window.location.href = "wip.html";
}
function showBuy(good) {
    var items = game.planets[game.currentPlanet].available_items;
    var price = items[good].buy_price;
    var available = items[good].available;
    var space = game.starships[game.currentStarship].cargoSpace;
    var limit = space + 1;
    if (greater(limit, available + 1)) {
        limit = available + 1;
    }
    if (greater(limit, Math.floor(game.credits / price))) {
        limit = Math.floor(game.credits / price) + 1;
    }
    document.getElementById(screenBuy).style.display = displayFlex;
    listOffersBuy(good, price, limit);
}
function showGameOver() {
    closePopups();
    document.getElementById(screenGameOver).style.display = displayFlex;
}
function showHelp() {
    window.location.href = "help.html";
}
function showNameChoice() {
    document.getElementById(screenLogin).style.display = displayFlex;
}
function showPlanet(planet) {
    var screen = whichScreen();
    if (screen === screenPlanet) {
        return;
    }
    if (screen === screenStarshipAtPlanet) {
        depart(planet);
        setPlanet(planet);
        return;
    }
    setPlanet(planet);
    listGoods(planet);
    listMarket(planet);
    listStarshipsAt(planet);
    document.getElementById(screenPlanet).style.display = displayFlex;
    return;
}
function showSell(good) {
    var starship = game.starships[game.currentStarship];
    var items = game.planets[game.currentPlanet].available_items;
    var price = items[good].sell_price;
    document.getElementById(screenSell).style.display = displayFlex;
    listOffersSell(good, price, starship.cargo[good] + 1);
}
function showStarshipAtPlanet(starship) {
    closePopups();
    var style = document.getElementById(screenStarshipAtPlanet).style;
    var planet = game.starships[starship].position;
    setPlanet(planet);
    listCargo(starship);
    listGoods(planet);
    listMarket(planet);
    style.display = displayFlex;
}
function showStarshipEnRoute(starship) {
    closePopups();
    var style = document.getElementById(screenStarshipEnRoute).style;
    var planet = game.starships[starship].position;
    setStarship(starship);
    style.display = displayFlex;
}
function startGame() {
    function updateTime() {
        var elements = document.getElementsByClassName("remaining-time");
        for (var i = 0; i < elements.length; ++i) {
            var el = elements[i];
            el.textContent = game.remainingTime.toString();
        }
    }
    updateTime();
    var clock = setInterval(function () {
        if (game.remainingTime === 0) {
            clearInterval(clock);
            gameOver();
            return;
        }
        --game.remainingTime;
        updateTime();
    }, 1000);
}
function trimOffersBuy(good) {
    var items = game.planets[game.currentPlanet].available_items;
    var available = items[good].available;
    var space = game.starships[game.currentStarship].cargoSpace;
    var limit = space + 1;
    if (greater(limit, available + 1)) {
        limit = available + 1;
    }
    var elements = document.getElementsByClassName(listOfOffers);
    for (var i = 0; i < elements.length; ++i) {
        var el = elements[i];
        for (var j = el.rows.length - 1; j > 0; --j) {
            var amount = getAmount(j - 1);
            if (greater(amount, limit - 1)) {
                el.deleteRow(j);
                continue;
            }
            if (greater(amount * items[good].buy_price, game.credits)) {
                el.deleteRow(j);
                continue;
            }
        }
    }
}
function trimOffersSell(good) {
    var starship = game.starships[game.currentStarship];
    var elements = document.getElementsByClassName(listOfOffers);
    for (var i = 0; i < elements.length; ++i) {
        var el = elements[i];
        for (var j = el.rows.length - 1; j > 0; --j) {
            var amount = getAmount(j - 1);
            if (greater(amount, starship.cargo[good])) {
                el.deleteRow(j);
            }
        }
    }
}
function trimScores() {
    function isLowest(i) {
        for (var j = 0; j < localStorage.length; ++j) {
            var scoreI = parseInt(i);
            var scoreJ = parseInt(localStorage.key(j));
            if (greater(scoreI, scoreJ)) {
                return false;
            }
        }
        return true;
    }
    for (var i = 0; i < localStorage.length; ++i) {
        if (isLowest(localStorage.key(i))) {
            localStorage.removeItem(localStorage.key(i));
            return;
        }
    }
}
function whichScreen() {
    function isVisible(x) {
        var style;
        style = document.getElementById(x).style;
        return style.display === displayFlex;
    }
    if (isVisible(screenBuy)) {
        return screenBuy;
    }
    if (isVisible(screenPlanet)) {
        return screenPlanet;
    }
    if (isVisible(screenSell)) {
        return screenSell;
    }
    if (isVisible(screenStarshipAtPlanet)) {
        return screenStarshipAtPlanet;
    }
    if (isVisible(screenStarshipEnRoute)) {
        return screenStarshipEnRoute;
    }
    return "";
}
if (localStorage.length === 0) {
    setDefaultScores();
}
listScores();
